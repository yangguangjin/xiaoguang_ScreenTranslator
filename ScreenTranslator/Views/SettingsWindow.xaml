<Window x:Class="ScreenTranslator.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="设置 - 小光翻译"
        Width="520" Height="780"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="{DynamicResource BackgroundBrush}">

    <Window.Resources>
        <Style x:Key="HelpButton" TargetType="Button">
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Content" Value="!"/>
            <Setter Property="Foreground" Value="#FFD700"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="#FFD700"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Cursor" Value="Help"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="200"/>
            <Setter Property="ToolTipService.Placement" Value="Top"/>
            <Setter Property="ToolTipService.VerticalOffset" Value="-4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Width="20" Height="20"
                                CornerRadius="10"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <TextBlock Text="{TemplateBinding Content}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Foreground="{TemplateBinding Foreground}"
                                       FontSize="{TemplateBinding FontSize}"
                                       FontWeight="{TemplateBinding FontWeight}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
        <StackPanel>
            <!-- 快捷键 -->
            <TextBlock Text="快捷键" Foreground="{DynamicResource PrimaryBrush}"
                       FontSize="14" FontWeight="Bold" Margin="0,0,0,8"/>
            <Grid Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="翻译热键" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" Text="{Binding Hotkey}"
                         IsReadOnly="True" Padding="6,4" FontSize="13"
                         PreviewKeyDown="HotkeyBox_PreviewKeyDown"
                         PreviewMouseDown="HotkeyBox_PreviewMouseDown"
                         GotFocus="HotkeyBox_GotFocus"
                         LostFocus="HotkeyBox_LostFocus"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="点击输入框后按下组合键或鼠标侧键来设置全局翻译快捷键，如 Alt+Q、Ctrl+Shift+T、XButton1"/>
            </Grid>

            <!-- 翻译 -->
            <TextBlock Text="翻译" Foreground="{DynamicResource PrimaryBrush}"
                       FontSize="14" FontWeight="Bold" Margin="0,0,0,8"/>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="目标语言" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox x:Name="TargetLangCombo" Grid.Column="1"
                          SelectedItem="{Binding TargetLanguage}"
                          Padding="6,4"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="选择翻译的目标语言，截图中的文字将被翻译为此语言"/>
            </Grid>
            <!-- AI 设置 -->
            <TextBlock Text="AI 设置" Foreground="{DynamicResource PrimaryBrush}"
                       FontSize="14" FontWeight="Bold" Margin="0,0,0,8"/>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="平台" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox x:Name="PlatformCombo" Grid.Column="1"
                          SelectedItem="{Binding AiPlatform}"
                          Padding="6,4"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="AI 服务平台。OpenAI/Custom 使用 OpenAI 兼容格式，Claude 使用 Anthropic 格式，Gemini 使用 Google 格式"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="接口地址" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" Text="{Binding AiEndpoint}"
                         Padding="6,4" FontSize="13"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="AI 平台的 API 基础地址，如使用代理或第三方中转服务请修改此地址"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="密钥" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <PasswordBox Grid.Column="1" x:Name="ApiKeyBox"
                             PasswordChanged="ApiKeyBox_PasswordChanged"
                             Padding="6,4" FontSize="13"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="AI 平台的 API 密钥，从对应平台的控制台获取，保存在本地配置文件中"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="模型" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" Text="{Binding AiModel}"
                         Padding="6,4" FontSize="13"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="AI 模型名称，如 gpt-4o-mini、claude-sonnet-4-20250514、gemini-pro"/>
            </Grid>
            <Grid Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="提示词" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Top" Margin="0,4,0,0"/>
                <TextBox Grid.Column="1" Text="{Binding AiVisionSystemPrompt}"
                         Padding="6,4" FontSize="13"
                         TextWrapping="Wrap" AcceptsReturn="True"
                         Height="80" VerticalScrollBarVisibility="Auto"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="AI 截图翻译的系统提示词，{targetLang} 会被替换为目标语言代码"
                        VerticalAlignment="Top" Margin="6,4,0,0"/>
            </Grid>

            <!-- 界面 -->
            <TextBlock Text="界面" Foreground="{DynamicResource PrimaryBrush}"
                       FontSize="14" FontWeight="Bold" Margin="0,0,0,8"/>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="字体大小" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" Text="{Binding FontSize}"
                         Padding="6,4" FontSize="13"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="主窗口中原文和译文的显示字体大小"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="不透明度" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <Slider Grid.Column="1" Minimum="0" Maximum="1.0"
                        Value="{Binding Opacity}"
                        SmallChange="0.01" LargeChange="0.1"
                        VerticalAlignment="Center"/>
                <TextBlock Grid.Column="2" VerticalAlignment="Center" Margin="8,0,0,0"
                           Foreground="{DynamicResource TextBrush}" FontSize="13">
                    <TextBlock.Text>
                        <Binding Path="Opacity" StringFormat="{}{0:P0}"/>
                    </TextBlock.Text>
                </TextBlock>
                <Button Grid.Column="3" Style="{StaticResource HelpButton}"
                        ToolTip="窗口不透明度，0% 为完全透明，100% 为完全不透明。设为 0 后可通过托盘图标恢复"/>
            </Grid>
            <Grid Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="显示器" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding MonitorList}"
                          SelectedIndex="{Binding PreferredMonitor}"
                          Padding="6,4"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="主窗口默认显示在第几个显示器上（从 1 开始）"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="窗口模式" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox x:Name="WindowModeCombo" Grid.Column="1"
                          SelectedValuePath="Value"
                          SelectedValue="{Binding WindowMode}"
                          Padding="6,4"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="独立窗口可自由拖拽定位；侧边栏模式窗口吸附到屏幕边缘"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="侧栏位置" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox x:Name="SidebarPositionCombo" Grid.Column="1"
                          SelectedValuePath="Value"
                          SelectedValue="{Binding SidebarPosition}"
                          Padding="6,4"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="侧边栏模式下窗口吸附的屏幕边缘位置"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="主题" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox x:Name="ThemeCombo" Grid.Column="1"
                          SelectedValuePath="Value"
                          SelectedValue="{Binding Theme}"
                          Padding="6,4"/>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="切换深色或浅色主题"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="强调色" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Top" Margin="0,6,0,0"/>
                <StackPanel Grid.Column="1">
                    <WrapPanel Margin="0,0,0,4">
                        <Button Content="  " Background="#2563EB" Width="28" Height="28" Margin="0,0,4,4" Tag="#2563EB" Click="PresetColor_Click" ToolTip="蓝色"/>
                        <Button Content="  " Background="#EF4444" Width="28" Height="28" Margin="0,0,4,4" Tag="#EF4444" Click="PresetColor_Click" ToolTip="红色"/>
                        <Button Content="  " Background="#22C55E" Width="28" Height="28" Margin="0,0,4,4" Tag="#22C55E" Click="PresetColor_Click" ToolTip="绿色"/>
                        <Button Content="  " Background="#F97316" Width="28" Height="28" Margin="0,0,4,4" Tag="#F97316" Click="PresetColor_Click" ToolTip="橙色"/>
                        <Button Content="  " Background="#A855F7" Width="28" Height="28" Margin="0,0,4,4" Tag="#A855F7" Click="PresetColor_Click" ToolTip="紫色"/>
                        <Button Content="  " Background="#EC4899" Width="28" Height="28" Margin="0,0,4,4" Tag="#EC4899" Click="PresetColor_Click" ToolTip="粉色"/>
                        <Button Content="  " Background="#06B6D4" Width="28" Height="28" Margin="0,0,4,4" Tag="#06B6D4" Click="PresetColor_Click" ToolTip="青色"/>
                        <Button Content="✕" Width="28" Height="28" Margin="0,0,4,4" Tag="" Click="PresetColor_Click" ToolTip="重置为默认" FontSize="11"/>
                    </WrapPanel>
                    <TextBox Text="{Binding AccentColor, UpdateSourceTrigger=PropertyChanged}"
                             Padding="6,4" FontSize="13" MaxLength="7"/>
                </StackPanel>
                <Button Grid.Column="2" Style="{StaticResource HelpButton}"
                        ToolTip="自定义强调色，点击预设色块或输入 hex 值如 #FF5500，留空使用主题默认色"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="背景图片" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" Text="{Binding BackgroundImagePath}"
                         IsReadOnly="True" Padding="6,4" FontSize="13"/>
                <Button Grid.Column="2" Content="浏览" Padding="8,4" Margin="4,0,0,0"
                        Click="BrowseBackgroundImage_Click"/>
                <Button Grid.Column="3" Style="{StaticResource HelpButton}"
                        ToolTip="选择一张图片作为主窗口背景，留空则无背景图"/>
            </Grid>
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="背景透明度" Foreground="{DynamicResource TextBrush}"
                           VerticalAlignment="Center"/>
                <Slider Grid.Column="1" Minimum="0.05" Maximum="0.5"
                        Value="{Binding BackgroundImageOpacity}"
                        SmallChange="0.01" LargeChange="0.05"
                        VerticalAlignment="Center"/>
                <TextBlock Grid.Column="2" VerticalAlignment="Center" Margin="8,0,0,0"
                           Foreground="{DynamicResource TextBrush}" FontSize="13">
                    <TextBlock.Text>
                        <Binding Path="BackgroundImageOpacity" StringFormat="{}{0:P0}"/>
                    </TextBlock.Text>
                </TextBlock>
                <Button Grid.Column="3" Style="{StaticResource HelpButton}"
                        ToolTip="背景图片的透明度，值越小越透明"/>
            </Grid>
            <CheckBox Content="开机自启动" Margin="0,0,0,16"
                      IsChecked="{Binding AutoStart}"
                      Foreground="{DynamicResource TextBrush}"/>

            <!-- 保存按钮 -->
            <Button Content="保存" Style="{StaticResource ToolbarButton}"
                    HorizontalAlignment="Right"
                    Padding="24,8"
                    Click="SaveBtn_Click"/>
</StackPanel>
    </ScrollViewer>
</Window>
